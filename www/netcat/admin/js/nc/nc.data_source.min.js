(function(e){var t={},n={ajax_path:"/netcat/action.php?ctrl=system.form.fields.data_source.data_source"},r="nc--disabled",i="nc--active",s=function(){return"console"in window?console.error.apply(console,arguments):null},o=function(){},u=function(t,n,r){var i=e(document.createElement(t));for(var s in n)i.attr(s,n[s]);r&&i.append(r);return i},a=function(e,t,n){n=n||"";var r="";if(t)for(var i in t)r+=" "+i+'="'+t[i]+'"';return"<"+e+r+">"+n+"</"+e+">"},f=function(t){var f={},l={},c={},h=function(){var t=f;for(var n in arguments){var r=arguments[n];if(!(r in t))return e.$();t=t[r]}return t},p=function(t,r){r=r||{};e.is_string(t)&&(t={action:t});var i="";for(var s in t)i+="&"+s+"="+t[s];r.url=n.ajax_path+i;r.dataType||(r.dataType="json");r.type||(r.type="POST");o("ajax():",r.url);return e.$.ajax(r)},d=function(){};d.init=function(n){var r=["container","field",["tabs","tabs>li"],["contents","contents>div"],"source_path","source_list","source_subclass","ordering_field","filter_field","bindings_tbody"];for(var i in r){var s=r[i],o=s;if(!e.is_string(s)){o=s[1];s=s[0]}f[s]=e("#"+t+"_"+o)}f.tab={};f.content={};f.tabs.each(function(t,n){var r=e(n).data("keyword");r&&(f.tab[r]=e(n))});f.contents.each(function(t,n){var r=e(n).data("keyword");if(r){f.content[r]=e(n);c[r]=!1}});d.set_value(n);d.process("init",{data:{field_value:l,field_name:t}});h("ordering_field").val("order_by"in l?l.order_by:"").keyup(function(){d.set_value({order_by:this.value})});h("filter_field").val("where"in l?l.where:"").keyup(function(){d.set_value({where:this.value})})};d.process=function(e,t){t=t||{};t.success||(t.success=d.process_json);t.error=function(e){s(e.responseText)};p(e,t)};d.process_json=function(t){var n;if("call"in t)for(n in t.call){var r=t.call[n];e.is_string(r)&&(r=[r]);d[n].apply(d,r)}if("action"in t)for(n in t.action)d.process(n,{data:t.action[n]});if("tab_content"in t)for(n in t.tab_content)d.set_tab_content(n,t.tab_content[n]);if("enable_tab"in t){e.is_string(t.enable_tab)&&(t.enable_tab=[t.enable_tab]);for(n in t.enable_tab)d.enable_tab(t.enable_tab[n])}"select_tab"in t&&d.select_tab(t.select_tab);"source_list"in t&&d.render_list(h("source_list"),t.source_list);"source_subclass"in t&&d.render_list(h("source_subclass"),t.source_subclass);"source_path"in t&&d.render_path(h("source_path"),t.source_path);"bindings_fields"in t&&d.render_bindings(h("bindings_tbody"),t.bindings_fields)};d.set_value=function(e,t){t=t||!1;e=e||{};if(t)l=e;else for(var n in e)l[n]=e[n];h("field").val(JSON.stringify(l))};d.select_tab=function(n,s){if(s&&e(s).parents("li").hasClass(r))return!1;if(h("tab",n).hasClass(i))return!1;if(!c[n]){d.process(n,{data:{field_value:l,field_name:t}});c[n]=!0}h("tabs").removeClass(i);d.enable_tab(n).addClass(i);h("contents").slideUp();h("content",n).slideDown();return!1};d.enable_tab=function(e){return h("tab",e).removeClass(r)};d.disable_tab=function(e){return h("tab",e).addClass(r)};d.alert=function(e){alert(e)};d.render_list=function(e,t){var n=u("ul",{"class":"nc-list nc--hovered"});for(var r=0;r<t.length;r++)n.append(d.make_list_item(t[r],!0));e.html(n)};d.render_path=function(e,t){var n=u("ul",{"class":"nc-path"});for(var r=0;r<t.length;r++)n.append(d.make_list_item(t[r]));e.html(n)};d.make_list_item=function(e,t){t===!0?t="<span class='nc-actions nc--on-hover'><span><i class='nc-icon nc--arrow-right'></i></span></span>":t=t||"";var n="icon"in e?a("i",{"class":"nc-icon nc--"+e.icon})+" ":"",r=u("a",{href:"#","class":"nc--blocked"},n+e.title+t);r.click(function(){d.process_json(e);return!1});return u("li",!1,r)};d.render_bindings=function(t,n){t.html("");"bindings"in l||(l.bindings={});var r=function(){var t=e(this).data("name");this.value?l.bindings[t]=this.value:delete l.bindings[t];d.set_value()};for(var i in n){var s=u("tr"),o=u("input",{type:"text","data-name":i}).keyup(r).change(r);i in l.bindings&&o.val(l.bindings[i]);s.append("<td>"+i+"</td>");s.append("<td>"+n[i]+"</td>");s.append(u("td",!1,o));t.append(s)}};d.set_tab_content=function(e,t){return h("content",e).html(t)};d();return d},l=function(e){typeof t[e]=="undefined"&&(t[e]=f(e));return t[e]};l.config=function(e){n=e};e.ext("data_source",l)})(nc);