(function(){function f(a){if(!(this instanceof f))return new f(a);this.set_options(a);if(!this.options.url)this.is_loaded=!0;return this}if(!("undefined"===typeof nc||nc!==nc.root)){var c=nc.root.$;c(window).on("resize.modal_dialog",function(){var a=c(".nc-modal-dialog:visible").data("modal_dialog");a&&a.resize&&a.resize()});var g=null,i=function(){var a=f.get_opened_dialog();if(null!==a){var b=a.options.persist,d=c("#simplemodal-placeholder");b&&this.d.placeholder?d.replaceWith(this.d.data.removeClass("simplemodal-data").css("display",
this.display)):(d.remove(),a.dialog_container.remove());c("#simplemodal-container, #simplemodal-overlay").remove();this.d={};g=null}},h=function(a){return'[data-tab-id="'+a+'"]'};f.get_opened_dialog=function(){return g&&g.is_open?g:null};f.get_current_dialog=function(){return g};f.prototype={constructor:f,options:{url:null,parameters:null,persist:!1,confirm_close:!0,on_show:c.noop,on_resize:c.noop,min_width:600,max_width:1200,full_markup:'<div class="nc-modal-dialog"><div class="nc-modal-dialog-header"><h2>&nbsp;</h2></div><div class="nc-modal-dialog-body"></div><div class="nc-modal-dialog-footer"></div></div>',
hidden_tabs:[]},loaded_markup:null,dialog_container:null,parts:{header:".nc-modal-dialog-header",title:".nc-modal-dialog-header h2",header_tabs:".nc-modal-dialog-header-tabs",body:".nc-modal-dialog-body",body_tabs:".nc-modal-dialog-body-tab",footer:".nc-modal-dialog-footer"},is_loaded:!1,is_open:!1,are_tabs_initialized:!1,set_options:function(a){this.options=c.extend(this.options,a)},set_option:function(a,b){this.options[a]=b},load:function(){var a=this;nc.process_start("nc.ui.modal_dialog.load()");
return c.get(this.options.url+"&isNaked=1",this.options.parameters||{}).done(function(b){a.loaded_markup=c.trim(b)}).always(function(){a.is_loaded=!0;nc.process_stop("nc.ui.modal_dialog.load()",0)})},create:function(){if(!this.is_loaded)return this.load().done(c.proxy(this,"create"));var a=this.options;this.loaded_markup&&c(this.loaded_markup).is(".nc-modal-dialog")?a=c(this.loaded_markup):(a=c(a.full_markup),this.loaded_markup&&a.find(".nc-modal-dialog-body").append(this.loaded_markup));g=this;this.dialog_container=
a.hide().data("modal_dialog",this).appendTo("body");this.init_tabs();this.init_form();this.init_buttons();return c.Deferred().resolve()},init_buttons:function(){var a=this,b=this.get_part("footer").find("button").off("click.modal_dialog");b.filter("[data-action=close]").on("click.modal_dialog",c.proxy(this,"close"));b.filter("[data-action=submit]").on("click.modal_dialog",function(){c(this).hasClass("nc--loading")||(nc.process_start("nc.ui.modal_dialog.submit_form()",this),a.submit_form())});if("undefined"!==
typeof nc_autosave_use&&1==nc_autosave_use&&(InitAutosave("adminForm"),null!==autosave&&"undefined"!==typeof autosave))b.filter("[data-action=save-draft]").on("click.modal_dialog",function(a){a.preventDefault();c(this).addClass("nc--loading");autosave.saveAllData(autosave)})},init_tabs:function(){if(!this.are_tabs_initialized){this.are_tabs_initialized=!0;var a=this,b=this.options.hidden_tabs,d=this.dialog_container.data("hiddenTabs");if(!c.isArray(b))a.options.hidden_tabs=b?[b]:[];d&&c.each(d.match(/[\w-]+/g),
function(b,c){a.options.hidden_tabs.push(c)});b=this.get_part("body").find("[data-tab-caption]");if(b.length){d=this.get_part("header_tabs");d.length||(d=c('<div class="nc-modal-dialog-header-tabs"/>').appendTo(this.get_part("header")));var e=d.children("ul"),f=1;e.length||(e=c("<ul/>").appendTo(d));b.addClass("nc-modal-dialog-body-tab").hide().each(function(){var b=c(this).data("tab-id")||"tab"+f++,d=c(this).attr("data-tab-id",b);c("<li>",{"data-tab-id":b,html:d.data("tab-caption")}).appendTo(e).click(function(b){a.change_tab(c(b.target).data("tab-id"))})});
c.each(this.options.hidden_tabs,function(b,c){a.hide_tab(c)});this.change_tab(b.eq(0).data("tab-id"))}}},init_form:function(){InitTransliterate();var a=this.find("#adminForm"),b=a.attr("action");a.ajaxForm({beforeSerialize:nc_save_editor_values,success:c.proxy(this,"process_form_submit_response")});-1==b.indexOf("isNaked=1")&&a.attr("action",b+(0<=b.indexOf("?")?"&":"?")+"isNaked=1")},submit_form:function(){this.find("#adminForm").submit()},process_form_submit_response:function(a,b,d,e){nc.process_stop("nc.ui.modal_dialog.submit_form()");
if(b=nc_check_error(a))this.show_error(b);else{var f=e.find("input[name=cc]").val(),e=window.location,b=(b=/^NewHiddenURL=(.+?)$/m.exec(a))?c.trim(b[1]):null;if(/^ReloadPage=1$/m.test(a))b&&!/\.php/.test(window.location.pathname)?((a=/\/([^\/]+)$/.exec(e.pathname))&&(b+=a[1]),e.pathname=b):e.reload(!0);else{var g=this;$nc.ajax({type:"GET",url:nc_page_url()+"&isNaked=1&admin_modal=1&cc_only="+f,success:function(a){nc_update_admin_mode_content(a,null,f);g.destroy()}})}}},show_error:function(a){var b=
this.get_part("footer"),d=c("<div class='nc-alert nc--red' />").append(c("<div class='nc-alert-close nc-icon-s nc--remove'></div>").click(function(){d.remove()})).append("<i class='nc-icon-l nc--status-error'></i>").append(a).appendTo(b)},change_tab:function(a){a=h(a);this.get_part("header_tabs").find("li").removeClass("nc--active").filter(a).addClass("nc--active").show();this.get_part("body_tabs").hide().filter(a).show();return this},hide_tab:function(a){a=h(a);this.get_part("header_tabs").find("li"+
a).hide();this.get_part("body_tabs").filter(a).hide();return this},get_tab:function(a){return this.get_part("body").find(h(a))},open:function(){var a=f.get_opened_dialog();a&&a.close();this.dialog_container?this.when_ready_to_open():this.create().done(c.proxy(this,"when_ready_to_open"));return this},when_ready_to_open:function(){c.modal(this.dialog_container,{onShow:c.proxy(this,"on_show"),onClose:i,persist:this.options.persist,closeHTML:'<a class="modalCloseImg" title="'+ncLang.Close+'"></a>',nc_confirm_close:this.options.confirm_close});
this.is_open=!0;this.resize()},on_show:function(){this.options.on_show(this)},close:function(){if(this.is_open)c.modal.close(),this.is_open=!1},resize:function(){if(!this.is_open)return this;var a=c(window.top.window),b=a.width()-200,d=a.height()-200,e=this.options;if(b>e.max_width)b=e.max_width;if(b<e.min_width)b=e.min_width;c("#simplemodal-container").css({width:b+"px",height:d+"px",left:Math.round((a.width()-b)/2-10)+"px",top:"100px"}).find(".simplemodal-wrap").css("overflow","auto");this.get_part("body").find(".nc--fill").css({width:b+
"px",height:d+"px"});e.on_resize();return this},destroy:function(){this.close();this.dialog_container.remove()},clear_all:function(){for(var a in this.parts)this.clear(a)},clear_part:function(a){this.get_part(a).empty()},find:function(a){this.dialog_container||this.create();return this.dialog_container.find(a)},get_part:function(a){return this.find(this.parts[a])}};nc.ext("modal_dialog",f,"ui")}})();
